@RestResource(urlMapping='/saveShikshaLead/*')
global class SaveShikshaLead {
    @HttpPost
    global static void doPost() {  
        API_log__c  api_log=new API_log__c();
        api_log.Log_Name__c='saveShikshaLead';
        
        RestRequest request = RestContext.request;  
        
        RestResponse response = RestContext.response;  
        
        
        
        String jSONRequestBody=request.requestBody.toString().replace('\n', '');
        api_log.Request__c= jSONRequestBody;
        api_log.created_date__c=Datetime.now();
        
        JSON2ApexShikshaLead jsonObj = JSON2ApexShikshaLead.parse(jSONRequestBody);  
        
        RecordType rt = [Select id,name From RecordType where Name='Student Account P'];
        User us = [SELECT ID, Name FROM User Where Name = 'Ayush Kalani'];
        
        Lead_Mode__c ldMode = [SELECT Id, Name From Lead_Mode__c WHERE Name=:'Digital'];
        String ldModeId = ldMode.Id;
       
        
        Lead_Source__c ldSource = [SELECT Id, Name FROM Lead_Source__c WHERE Name =:'Shiksha'];
        String ldSourceId = ldSource.Id;
       
        List<Account> ccList = new List<Account>();
        List<Account> ccList_up = new List<Account>();
        For(StudentAccount s:jsonObj.StudentAccount){
            
            Account cc = new Account();
            cc.Salutation = s.Salutation;
            cc.FirstName = s.FirstName;
            cc.OwnerId = us.Id;
            cc.LastName = s.LastName;
            cc.Lead_Mode__c = ldModeId;
            cc.Lead_Source1__c = ldSourceId;
            
            cc.PersonEmail = s.Email;
            cc.Phone = s.Phone;
            cc.PersonMobilePhone = s.Mobile;
            cc.Lead_Stage__c = 'Open';
            cc.RecordTypeId = rt.Id;
            If(s.dncphone!='0'){
                cc.DNC_Phone__c = True;
            }
            If(s.dncmobile!='0'){
                cc.DNC_Mobile__c = True;
            }
            cc.PersonMailingStreet = s.Street;
            cc.PersonMailingCity = s.City;
            cc.PersonMailingState = s.State;
            cc.PersonMailingPostalCode = s.PostalCode;
            cc.PersonMailingCountry = s.Country;
            
             //add by shashank_30_03_2020
            cc.Program_Category__c=s.ProgramCategory;
            
            ccList.add(cc);
            
        }
        
        
        
        try{
            insert ccList;
            String resp = JSON.serialize('{"Message":"Data Saved Successfully"}');
            response.responseBody = Blob.valueOf(resp);
            response.addHeader('Content-Type', 'application/json');
            response.statusCode = 200;
            api_log.Response__c= String.valueOf(resp);
            api_log.response_time__c=Datetime.now();
            
        }catch(Exception e){
            System.debug('Format Error');
            String resp = JSON.serialize('{"Message":"Data Format Error"}');
            response.responseBody = Blob.valueOf(resp);
            response.addHeader('Content-Type', 'application/json');
            
            response.statusCode = 200;
            api_log.Response__c= String.valueOf(resp);
            api_log.response_time__c=Datetime.now();
            
        }
        insert api_log;
    }  
    
    //
// Generated by JSON2Apex http://json2apex.herokuapp.com/
//

public class JSON2ApexShikshaLead {
    public List<StudentAccount> StudentAccount;
}

	public class StudentAccount {
		public String LeadStatus;
		public String Owner;
		public String Salutation;
		public String Website;
		public String FirstName;
		public String Company;
		public String MiddleName;
		public String Industry;
		public String LastName;
		public String NoOfEmployees;
		public String Suffix;
		public String LeadSource;
		public String Title;
		public String Email;
		public String Phone;
		public String Mobile;
		public String Rating;
		public String Street;
		public String City;
		public String State;
		public String PostalCode;
		public String Country;
        public String DNCMobile;
        public string DNCPhone;
        public String ProgramCategory;
	}

	

	
	public static JSON2ApexShikshaLead parse(String json) {
		return (JSON2ApexShikshaLead) System.JSON.deserialize(json, JSON2ApexShikshaLead.class);
	}

    
}