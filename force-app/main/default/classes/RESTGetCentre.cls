global class RESTGetCentre implements Schedulable{//need to create schedulable
    
    global void execute(SchedulableContext sc)
        {
            getCall();
        }
    
    public void getCall(){
        
        
        String city = '0';
        String js = '{"txtcity\":\"'+city+'\"}';
        String s = '';
        Http h = new Http();		
        HttpRequest req = new HttpRequest();
        
        req.setMethod('POST');
        req.setBody(js);
        req.setTimeout(120000);
        req.setHeader('Content-type', 'application/json');
        req.setHeader('token', s);
        req.setEndpoint('https://lima.imsindia.com/MyIMS/default.aspx?action=getcentre');//sandbox url
        
        System.debug('The request is made to Lima for Centre---'+req);
        HttpResponse res = h.send(req);
        
        
        
        JSON2ApexGetCentre jsCentre = JSON2ApexGetCentre.parse(res.getBody());
        
        List<centre> centrCity = new List<centre>();
        Set<String> codeSet = new Set<String>();
        If(jsCentre.centre.size()>0){
            For(centre st:jsCentre.centre){
                //System.debug('I am printing --'+st);
                centrCity.add(st);
                codeSet.add(st.Code);
            }
        }else{
            System.debug('StudentCity is Empty');
        }
        System.debug('---Final I am printing the Centre List---'+codeSet);
        Integer listSize = centrCity.size();
        
        List<Centre__c> centreList = [SELECT ID, Name, Centre_Code__c FROM Centre__c WHERE Centre_Code__c IN:codeSet];
        System.debug('I am geting centre list-->'+centreList);
        Map<String,Id> stMAp = new Map<String,Id>();
        for(Centre__c ct:centreList){
            stMAp.put(ct.Centre_Code__c, ct.Id);
        }
        
        List<Centre__c> ncenterList = new List<Centre__c>();
        for(centre st:jsCentre.centre){
            Centre__c cen = new Centre__c();
            if(stMAp.get(st.Code) != null){
                cen.Id = stMAp.get(st.Code);
                
            }
            cen.Name = st.Centre;
            cen.Centre_Code__c = st.code;
            ncenterList.add(cen);
        }
        System.debug('Final list before upsert-->'+ncenterList);
        Database.UpsertResult [] ucenterList = Database.upsert(ncenterList, True);
        
        
        
        
    }
    
    
    //
    // Generated by JSON2Apex http://json2apex.herokuapp.com/
    //
    
    public class JSON2ApexGetCentre {
        
        public List<Centre> centre;
    }
    
    public class Centre {
        public String Code;
        public String Centre;
    }
    
    
    public static JSON2ApexGetCentre parse(String json) {
        return (JSON2ApexGetCentre) System.JSON.deserialize(json, JSON2ApexGetCentre.class);
    }
    
}