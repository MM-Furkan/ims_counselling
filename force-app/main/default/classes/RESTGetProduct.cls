global class RESTGetProduct implements Schedulable {
    
     global void execute(SchedulableContext sc)
        {
            getCall();
        } 
    
    public void getCall(){
        
        String programCode = '0';
        String js = '{"txtcentre\":\"'+programCode+'\"}';
        String s = '';
        Http h = new Http();		
        HttpRequest req = new HttpRequest();
        
        req.setMethod('POST');
        req.setBody(js);
        req.setTimeout(120000);
        req.setHeader('Content-type', 'application/json');
        req.setHeader('token', s);
       // req.setEndpoint('http://demo.imsindia.com/MyIMS/default.aspx?action=getproduct');//deno  url
        req.setEndpoint('https://lima.imsindia.com/MyIMS/default.aspx?action=getproduct');// production url 
        
        System.debug('The request is made to -in Account---'+req);
        HttpResponse res = h.send(req);
        
        JSON2ApexGetProduct jsProgram = JSON2ApexGetProduct.parse(res.getBody());
        List<product> prodt = new List<product>();
        Set<String> codeSet = new Set<String>();
        If(jsProgram.product.size()>0){
            For(product st:jsProgram.product){
                System.debug('I am printing --'+st);
                prodt.add(st);
                codeSet.add(st.Code);
            }
        }else{
            System.debug('Product List is Empty');
        }
        
        List<Program__c> productList = [SELECT Id, Name, Program_Code__c FROM Program__c WHERE Program_Code__c=:codeSet];
        System.debug('I am geting product list-->'+productList);
        Map<String,Id> stMAp = new Map<String,Id>();
        for(Program__c ct:productList){
            stMAp.put(ct.Program_Code__c, ct.Id);
        }
        
         List<Program__c> ncenterList = new List<Program__c>();
        for(product st:jsProgram.product){
            Program__c cen = new Program__c();
            if(stMAp.get(st.Code) != null){
                cen.Id = stMAp.get(st.Code);
                
            }
            cen.Name = st.Product;
            cen.Program_Code__c = st.code;
            ncenterList.add(cen);
        }
        System.debug('Final list before upsert-->'+ncenterList);
        Database.UpsertResult [] ucenterList = Database.upsert(ncenterList, True);
        
        
    }
    
    //
    // Generated by JSON2Apex http://json2apex.herokuapp.com/
    //
    
    public class JSON2ApexGetProduct {
        
        public List<Product> product;
    }
    public class Product {
        public String Code;
        public String Product;
    }
    
    
    
    
    public static JSON2ApexGetProduct parse(String json) {
        return (JSON2ApexGetProduct) System.JSON.deserialize(json, JSON2ApexGetProduct.class);
    }
    
}