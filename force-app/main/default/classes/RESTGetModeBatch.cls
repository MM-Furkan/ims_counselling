global class RESTGetModeBatch implements Database.Batchable<Object>,   Database.AllowsCallouts {
    
    List<Object> codeList;
    
   /* public RESTGetModeBatch(List<Object> tempCodeList){
        System.debug('I am called constructor-->'+tempCodeList);
        codeList = tempCodeList;
        
        
    }*/
    global  Iterable <Object> start(Database.BatchableContext BC) {
        System.debug('I am called start-->');
        return codeList;//Database.getQueryLocator(query);
        
    }
    global void execute(Database.BatchableContext BC, List<Object> records) { 
        
        List<String> centreCodeList = new List<String>();
        List<String> programCodeList = new List<String>();
        
        
        centreCodeList = (List<String>)records[0];
        programCodeList = (List<String>)records[1];
        
        String centreCode = '';
        String programCode = '';
        For(String s:centreCodeList){
            If(centreCode ==''){
                centreCode = s; 
            }else{
                centreCode = centreCode + ',' + s;
            }
            
        }
        
        For(String s:programCodeList){
            If(programCode ==''){
                programCode = s; 
            }else{
                programCode = programCode + ',' + s;
            }
            
        }
        System.debug('I am printing centreCode-->'+centreCode);
        System.debug('I am printing programCode-->'+programCode);
        String js = '{\"txtcentre\":\"'+centreCode+'\",\"txtproduct\":\"'+programCode+'\"}';
        String s = '';
        Http h = new Http();		
        HttpRequest req = new HttpRequest();
        
        req.setMethod('POST');
        req.setBody(js);
        req.setTimeout(120000);
        req.setHeader('Content-type', 'application/json');
        req.setHeader('token', s);
        req.setEndpoint('http://lima.imsindia.com/MyIMS/default.aspx?action=getmode');//sandbox url
        
        System.debug('The request is made to Datamatics-in Account---'+req);
        HttpResponse res = h.send(req);
        System.debug('The response is getting from Datamatics--in Account--'+res);
        System.debug('res.getbody'+res.getbody());
        String jsun = res.getBody();
        JSON2ApexGetMode jsCentre = JSON2ApexGetMode.parse(res.getBody());
        List<Mode> needToReturn = new List<Mode>();
        If(jsCentre.mode.size()>0){
            For(mode st:jsCentre.mode){
                System.debug('I am printing --'+st);
                needToReturn.add(st);
            }
            //return needToReturn;
        }else{
            System.debug('Centre is Empty');
            //return null;
        }
        
    }
    global void finish(Database.BatchableContext BC){    
    }
    
     //
    // Generated by JSON2Apex http://json2apex.herokuapp.com/
    //
    
    public class JSON2ApexGetMode {
        
        public List<Mode> mode;
    }
    
    public class Mode {
        public String Code;
        public String Mode;
    }
    
    
    public static JSON2ApexGetMode parse(String json) {
        return (JSON2ApexGetMode) System.JSON.deserialize(json, JSON2ApexGetMode.class);
    }
    
    
}